processor PIC16f877A ; procesador
org 0x00			 ; vector de reset
Goto 0x05			 ; envia PC a la direccion 0x05
org 0x05			 ; origen del programa

#include <P16F877A.inc>

INDICE EQU 0X20
DATO EQU 0X21
DATO_R EQU 0X22 

BSF STATUS,RP0
BCF STATUS,RP1
BCF TRISC,RC6
BSF TXSTA,TXEN
BCF TXSTA,SYNC
BCF TXSTA,BRGH

MOVLW .31
MOVWF SPBRG

BCF STATUS,RP0
BSF RCSTA,SPEN
BSF RCSTA,SREN
BSF RCSTA,CREN

INICIA
	CLRF INDICE 
REPITE
	CALL RECIBE 
	MOVWF DATO_R
	XORLW '1'
	BTFSS STATUS,Z
	GOTO DOS?
	CALL UNO
	GOTO INICIA

DOS?
	MOVF DATO_R,W	
	XORLW '2'
	BTFSS STATUS,Z
	GOTO INICIA
	CALL DOS
	GOTO INICIA

UNO
	CLRF INDICE
REGRESA
	MOVF INDICE,W
	CALL TABLA2
	MOVWF DATO
	XORLW '$'
	BTFSC STATUS,Z
	RETURN
	MOVF DATO,W
	CALL ENVIA
	INCF INDICE
	GOTO REGRESA

DOS
	CLRF INDICE
REGRESA_DOS
	MOVF INDICE,W
	CALL TABLA1
	MOVWF DATO
	XORLW '$'
	BTFSC STATUS,Z
	RETURN
	MOVF DATO,W
	CALL ENVIA
	INCF INDICE
	GOTO REGRESA_DOS	
	
TABLA1
	ADDWF PCL,1
	RETLW 'U'
	RETLW 'N'
	RETLW 'O'
	RETLW '\n'
	RETLW '\r'
	RETLW '$'

TABLA2
	ADDWF PCL,1
	RETLW 'D'
	RETLW 'O'
	RETLW 'S'
	RETLW '\n'
	RETLW '\r'
	RETLW '$'
	
ENVIA	
	BSF STATUS,RP0
	BCF STATUS,RP1
	BTFSS TXSTA,TRMT
	GOTO $-1
	
	BCF STATUS,RP0
	MOVF DATO,W
	MOVWF TXREG
	RETURN

RECIBE
	BTFSS PIR1,RCIF
	GOTO $-1
	MOVF RCREG,W
	RETURN

END
	
	
	